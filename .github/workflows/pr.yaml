# Copyright 2024, UNSW
#
# SPDX-License-Identifier: BSD-2-Clause

# Actions to *only* run on GitHub pull requests

name: PR

on: [pull_request]

jobs:
  whitespace:
    name: 'Trailing Whitespace'
    runs-on: ubuntu-latest
    steps:
    - uses: seL4/ci-actions/git-diff-check@master

  style_c:
    name: Style (C)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        # We use this form as this creates a "test-revision" rev in the git repo,
        # which we can use to compare against. Also, git-clang-format only diffs
        # changed files, so we need a proper checkout.
        run: |
          curl https://raw.githubusercontent.com/seL4/ci-actions/master/scripts/checkout.sh | bash
          curl https://raw.githubusercontent.com/seL4/ci-actions/master/scripts/fetch-base.sh | bash
          git rev-parse test-revision

      - name: Ensure clang-format-18
        run: |
          clang-format-18 --version

      - name: Check formatting
        run: |
          git clang-format-18 --diff ${GITHUB_BASE_REF} test-revision --verbose
